# nchc-web-2018

## Overview

### Directories

**config** : config files for services
- **.sensor.csv** : sensor positions
- **rack-config** : sensing point layout on racks

**example** : example config files and scripts

**nchc** : primary functions of web services

**script** : scripts for data pre-processing

**web** : default path for hosting web pages on **/** of web server, it should be copied from `../build` that contains the release version of web pages

## Usage

- Prepare dependency

```
$ go get -u github.com/labstack/echo/...
# link this repository as go lib
$ mkdir $GOPATH/src/nchc.org.tw
# if your work directory is in server
$ ln -s $(cd .. && pwd) $GOPATH/src/nchc.org.tw/nchc-web-2018
```

- Install go dependency

```
$ make deps
```

- Compile web server

```
$ make build
```

- Run web server locally

```
$ make run
```

- Start web server via docker image

```
$ make build-docker
$ docker run --rm -v /your-data-path:/app/data -p 3266:3266 nchc-aidc/web-server
```

It will host web and api server at port 3266

`data` is the default path of data

## Environment Variables

- NCHCdataSourcePath
  - default: `data`
  - path of data, each directory indicates a data set, e.g., OA20180829-201
  - the absolute path in docker is `/app/data` with the working directory `app`
  - each data directory should have 4 raw data files (temperature[0-3].csv)

- NCHCconfigPath
  - default: `config`
  - path of config, each csv file indicates a sensor layout, e.g., oa.sensor.csv

## Development

By default, the API server will host the local directory **web** at the root path **/** . Also, the new pictures generated by API server will locate on `web/images` . If you are developing the web page with react server, the image path, i.e., `cacheImagePath` in **nchc.go**, should be changed to the runtime path of development, e.g., **../public/images**.

The default api url is `http://localhost:3266`. If the web server is running within a container with different port mapping or the browser is on the different network address, `apiURL` should be modified so that the web page can connect to the API server correctly.
